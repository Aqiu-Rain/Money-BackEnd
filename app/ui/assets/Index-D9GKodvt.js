import{d as S,_ as N,r as D,c as C,o as V,a as O,b as a,e as t,u as i,w as l,f as r,g as W,m as E,s as I,h as p,t as m,i as B,j as P}from"./index-VfqKZcDz.js";import{s as b}from"./request-QqSoPAZ6.js";import{u as T,g as j}from"./settings-CzuvPNO6.js";const H=S("websocketStore",{state(){return{data:[],status:"等待链接",message:"",socket:null}},actions:{setData(c){this.sendData.length>2e3&&(this.data=[],b("warning","页面已达2000条设置上限，清空之前数据，但是您可以在历史数据中查看之前的数据")),this.data.push(c)},connect(c){this.socket=new WebSocket(c),this.socket.onopen=()=>{this.socket.readyState===WebSocket.OPEN&&(this.status="已经连接")},this.socket.onclose=()=>{this.socket.readyState===WebSocket.OPEN&&(this.status="等待链接",this.socket.close())},this.socket.onerror=o=>{this.socket.close(),this.status="等待链接",console.log(o),this.message=o},this.socket.onmessage=o=>{const u=JSON.parse(o.data);u.type==="serial_data"&&this.setData(u.data)}},disconnect(){this.socket.close(),this.status="等待链接",this.socket=null},sendData(c){this.socket.send(JSON.stringify(c))}}}),J={class:"container"},M={class:"header"},z={class:"header-right"},U={class:"search-container"},q={class:"function-area"},A={style:{width:"120px"}},F={style:{flex:"1",display:"flex","align-items":"center","justify-content":"flex-end"}},G={class:"content"},K=["src"],L="ws://127.0.0.1:8000/ws",Q={__name:"Index",setup(c){const o=D(""),u=C(()=>window.innerHeight-80),n=H(),f=T();V(()=>{j().then(d=>{f.setItem(d.data)}).catch(d=>{b("error","获取设置失败")})});const k=()=>{n.connect(L),setTimeout(()=>{if(n.socket.readyState===WebSocket.OPEN){let d={cmd:"start",param:f.setting};n.sendData(d)}},1e3)},w=()=>{n.disconnect()};return(d,e)=>{const y=r("el-input"),h=r("el-tag"),x=r("el-divider"),g=r("el-button"),s=r("el-table-column"),v=r("el-table");return W(),O("div",J,[a("div",M,[e[4]||(e[4]=a("div",{class:"header-left"},[a("h3",{style:{"font-family":"幼圆,serif"}},"点钞记录系统")],-1)),a("div",z,[a("div",U,[t(y,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=_=>o.value=_),size:"large","prefix-icon":i(E),"suffix-icon":i(I)},null,8,["modelValue","prefix-icon","suffix-icon"])]),a("div",q,[a("div",A,[t(h,{type:"success"},{default:l(()=>[p(m(i(n).data.length),1)]),_:1}),t(x,{direction:"vertical"}),t(h,{type:"success"},{default:l(()=>e[1]||(e[1]=[p("2000")])),_:1})]),a("div",F,[t(h,{round:"",type:"primary",style:{"margin-right":"15px"}},{default:l(()=>[p(m(i(n).status),1)]),_:1}),t(g,{icon:i(B),round:"",type:"primary",onClick:k},{default:l(()=>e[2]||(e[2]=[p("Start")])),_:1},8,["icon"]),t(g,{icon:i(P),round:"",type:"danger",onClick:w},{default:l(()=>e[3]||(e[3]=[p("Stop")])),_:1},8,["icon"])])])])]),a("div",G,[t(v,{data:i(n).data,height:u.value,border:"",style:{width:"100%"}},{default:l(()=>[t(s,{prop:"date",label:"日期",width:"150",fixed:"left",align:"center"}),t(s,{prop:"time",label:"时间",width:"120",fixed:"left",align:"center"}),t(s,{prop:"tf_flag",label:"真伪标志",width:"120",fixed:"left",align:"center"}),t(s,{prop:"valuta",label:"币值",width:"120",align:"center"}),t(s,{prop:"fsn_count",label:"纸币计数",width:"100",align:"center"}),t(s,{prop:"char_num",label:"冠字号码字符数",width:"130",align:"center"}),t(s,{prop:"sno",label:"冠字号码",width:"120",align:"center"}),t(s,{prop:"machine_sno",label:"机具编号",width:"120",align:"center"}),t(s,{prop:"reserve1",label:"保留字",align:"center"}),t(s,{fixed:"right",prop:"image_data",label:"冠字号码图像",align:"center"},{default:l(_=>[a("img",{src:"data:image/bmp;base64,"+_.row.image_data,alt:"冠字号码图像"},null,8,K)]),_:1})]),_:1},8,["data","height"])])])}}},Z=N(Q,[["__scopeId","data-v-e84e21eb"]]);export{Z as default};
