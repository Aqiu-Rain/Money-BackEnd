import{d as D,_ as E,u as I,r as V,c as y,o as O,a as z,b as n,t as d,e,f as o,g as w,w as r,h,i as _,m as B,s as P,j as u,k as T,l as j}from"./index-CathrdzK.js";import{s as v,a as p}from"./request-BUxG3FlR.js";import{u as H,g as J}from"./settings-GZtTgjrQ.js";const L=D("websocketStore",{state(){return{data:[],status:"Waiting Connect",message:"",socket:null}},actions:{setData(l){this.data.length>=500&&(this.data=[],v("warning","The page has reached the 500-entry setting limit. Previous data has been cleared, but you can view it in the history.")),this.data.unshift(l)},connect(l){this.socket=new WebSocket(l),this.socket.onopen=()=>{this.socket.readyState===WebSocket.OPEN&&(this.status="Connected")},this.socket.onclose=()=>{this.socket.readyState===WebSocket.OPEN&&(this.status="Waiting Connect",this.socket.close())},this.socket.onerror=i=>{p("Error",i,"error",3e3,"top-right");try{this.socket.close(),this.status="Waiting Connect",this.message=i,this.socket=null}catch(a){this.status="Waiting Connect",this.message=a,this.socket=null}finally{this.status="Waiting Connect",this.socket=null}},this.socket.onmessage=i=>{const a=JSON.parse(i.data);if(a.type==="serial_data")this.setData(a.data);else if(a.type==="notification")p("Success",a.data,"success",3e3,"top-right");else if(a.type==="error"){p("Error",a.data,"error",3e3,"top-right");try{this.socket.close(),this.socket=null,this.status="Waiting Connect"}catch{this.socket=null,this.status="Waiting Connect"}finally{this.socket=null,this.status="Waiting Connect"}}}},disconnect(){try{this.socket.close(),this.status="Waiting Connect",this.socket=null}catch(l){p("Error","Disconnect error:"+l,"error",3e3,"top-right"),this.status="Waiting Connect",this.socket=null}finally{this.socket=null,this.status="Waiting Connect"}},sendData(l){this.socket.send(JSON.stringify(l))}}}),M={class:"container"},U={class:"header"},q={class:"header-left"},A={style:{"font-family":"幼圆,serif"}},F={class:"header-right"},G={class:"search-container"},K={class:"function-area"},Q={style:{width:"120px"}},R={style:{flex:"1",display:"flex","align-items":"center","justify-content":"flex-end"}},X={class:"content"},Y=["src"],Z="ws://127.0.0.1:8000/ws",tt={__name:"Index",setup(l){I();const i=V(""),a=y(()=>window.innerHeight-80),s=L(),b=H(),C=y(()=>i.value===""?s.data:s.data.filter(t=>{t.sno.toLowerCase().includes(i.value.toLowerCase())}));O(()=>{J().then(t=>{b.setItem(t.data)}).catch(t=>{v("error","get settings failed:"+t)})});const S=()=>{s.connect(Z),setTimeout(()=>{if(s.socket.readyState===WebSocket.OPEN){let t={cmd:"start",param:b.setting};s.sendData(t)}},1500)},W=()=>{s.disconnect()};return(t,g)=>{const x=h("el-input"),f=h("el-tag"),$=h("el-divider"),k=h("el-button"),c=h("el-table-column"),N=h("el-table");return _(),z("div",M,[n("div",U,[n("div",q,[n("h3",A,d(t.$t("message.name")),1)]),n("div",F,[n("div",G,[e(x,{modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=m=>i.value=m),size:"large","prefix-icon":o(B),"suffix-icon":o(P)},null,8,["modelValue","prefix-icon","suffix-icon"])]),n("div",K,[n("div",Q,[o(s).data.length<400?(_(),w(f,{key:0,type:"success",round:""},{default:r(()=>[u(d(o(s).data.length),1)]),_:1})):(_(),w(f,{key:1,type:"warning",round:""},{default:r(()=>[u(d(o(s).data.length),1)]),_:1})),e($,{direction:"vertical"}),e(f,{type:"success",round:""},{default:r(()=>g[1]||(g[1]=[u("500")])),_:1})]),n("div",R,[e(f,{round:"",type:"primary",style:{"margin-right":"15px"}},{default:r(()=>[u(d(o(s).status),1)]),_:1}),e(k,{icon:o(T),round:"",type:"primary",onClick:S,disabled:o(s).socket!==null},{default:r(()=>[u(d(t.$t("message.start")),1)]),_:1},8,["icon","disabled"]),e(k,{icon:o(j),round:"",type:"danger",onClick:W,disabled:o(s).socket===null},{default:r(()=>[u(d(t.$t("message.stop")),1)]),_:1},8,["icon","disabled"])])])])]),n("div",X,[e(N,{data:C.value,height:a.value,border:"",style:{width:"100%","font-size":"18px"}},{default:r(()=>[e(c,{prop:"create_at",label:t.$t("message.datetime"),width:"300",fixed:"left",align:"center"},null,8,["label"]),e(c,{prop:"money_flag",label:t.$t("message.bizhong"),width:"120",fixed:"left",align:"center"},null,8,["label"]),e(c,{prop:"valuta",label:t.$t("message.bizhi"),width:"120",fixed:"left",align:"center"},null,8,["label"]),e(c,{prop:"ver",label:t.$t("message.version"),width:"120",fixed:"left",align:"center"},null,8,["label"]),e(c,{prop:"tf_flag",label:t.$t("message.code"),width:"120",fixed:"left",align:"center"},null,8,["label"]),e(c,{prop:"machine_number",label:t.$t("message.machine_num"),width:"130",align:"center"},null,8,["label"]),e(c,{prop:"sno",label:t.$t("message.mno"),width:"180",align:"center"},null,8,["label"]),e(c,{fixed:"right",prop:"image_data",label:t.$t("message.mnoImg"),width:"300",align:"center"},{default:r(m=>[n("img",{src:"data:image/bmp;base64,"+m.row.image_data,alt:"冠字号码图像",style:{height:"40px"}},null,8,Y)]),_:1},8,["label"])]),_:1},8,["data","height"])])])}}},nt=E(tt,[["__scopeId","data-v-64d3bfe9"]]);export{nt as default};
