import{d as C,_ as V,u as I,r as O,c as W,o as B,a as P,b as n,e as t,f as o,g as x,w as c,h,i as g,m as T,s as j,j as u,t as m,k as z,l as H}from"./index-BzML5hP_.js";import{s as w,a as p}from"./request-C_38H3Sb.js";import{u as J,g as M}from"./settings-HglyURAT.js";const U=C("websocketStore",{state(){return{data:[],status:"等待链接",message:"",socket:null}},actions:{setData(i){this.data.length>=500&&(this.data=[],w("warning","页面已达500条设置上限，清空之前数据，但是您可以在历史数据中查看之前的数据")),this.data.unshift(i)},connect(i){this.socket=new WebSocket(i),this.socket.onopen=()=>{this.socket.readyState===WebSocket.OPEN&&(this.status="已经连接")},this.socket.onclose=()=>{this.socket.readyState===WebSocket.OPEN&&(this.status="等待链接",this.socket.close())},this.socket.onerror=r=>{p("Error",r,"error",3e3,"top-right");try{this.socket.close(),this.status="等待链接",this.message=r,this.socket=null}catch(e){this.status="等待链接",this.message=e,this.socket=null}finally{this.status="等待链接",this.socket=null}},this.socket.onmessage=r=>{const e=JSON.parse(r.data);if(console.log("======================"),console.log(e),console.log("======================"),e.type==="serial_data")this.setData(e.data);else if(e.type==="notification")p("Success",e.data,"success",3e3,"top-right");else if(e.type==="error"){p("Error",e.data,"error",3e3,"top-right");try{this.socket.close(),this.socket=null,this.status="等待链接"}catch{this.socket=null,this.status="等待链接"}finally{this.socket=null,this.status="等待链接"}}}},disconnect(){console.log("-------disconnect-------");try{this.socket.close(),this.status="等待链接",this.socket=null}catch(i){p("Error","Disconnect error:"+i,"error",3e3,"top-right"),this.status="等待链接",this.socket=null}finally{this.socket=null,this.status="等待链接"}},sendData(i){console.log("-----send data ------"),console.log(i),this.socket.send(JSON.stringify(i))}}}),q={class:"container"},A={class:"header"},F={class:"header-right"},G={class:"search-container"},K={class:"function-area"},L={style:{width:"120px"}},Q={style:{flex:"1",display:"flex","align-items":"center","justify-content":"flex-end"}},R={class:"content"},X=["src"],Y="ws://127.0.0.1:8000/ws",Z={__name:"Index",setup(i){const{t:r}=I(),e=O(""),k=W(()=>window.innerHeight-80);console.log(r("message.hello"));const s=U(),y=J();B(()=>{M().then(d=>{y.setItem(d.data)}).catch(d=>{w("error","获取设置失败:"+d)})});const v=()=>{s.connect(Y),setTimeout(()=>{if(s.socket.readyState===WebSocket.OPEN){let d={cmd:"start",param:y.setting};s.sendData(d)}},1e3)},S=()=>{s.disconnect()};return(d,a)=>{const N=h("el-input"),f=h("el-tag"),D=h("el-divider"),b=h("el-button"),l=h("el-table-column"),E=h("el-table");return g(),P("div",q,[n("div",A,[a[4]||(a[4]=n("div",{class:"header-left"},[n("h3",{style:{"font-family":"幼圆,serif"}},"点钞记录系统")],-1)),n("div",F,[n("div",G,[t(N,{modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=_=>e.value=_),size:"large","prefix-icon":o(T),"suffix-icon":o(j)},null,8,["modelValue","prefix-icon","suffix-icon"])]),n("div",K,[n("div",L,[o(s).data.length<10?(g(),x(f,{key:0,type:"success",round:""},{default:c(()=>[u(m(o(s).data.length),1)]),_:1})):(g(),x(f,{key:1,type:"warning",round:""},{default:c(()=>[u(m(o(s).data.length),1)]),_:1})),t(D,{direction:"vertical"}),t(f,{type:"success",round:""},{default:c(()=>a[1]||(a[1]=[u("500")])),_:1})]),n("div",Q,[t(f,{round:"",type:"primary",style:{"margin-right":"15px"}},{default:c(()=>[u(m(o(s).status),1)]),_:1}),t(b,{icon:o(z),round:"",type:"primary",onClick:v,disabled:o(s).socket!==null},{default:c(()=>a[2]||(a[2]=[u("Start")])),_:1},8,["icon","disabled"]),t(b,{icon:o(H),round:"",type:"danger",onClick:S,disabled:o(s).socket===null},{default:c(()=>a[3]||(a[3]=[u("Stop")])),_:1},8,["icon","disabled"])])])])]),n("div",R,[t(E,{data:o(s).data,height:k.value,border:"",style:{width:"100%","font-size":"18px"}},{default:c(()=>[t(l,{prop:"create_at",label:"日期时间",width:"300",fixed:"left",align:"center"}),t(l,{prop:"money_flag",label:"币种",width:"100",fixed:"left",align:"center"}),t(l,{prop:"valuta",label:"币值",width:"120",fixed:"left",align:"center"}),t(l,{prop:"ver",label:"版本",width:"120",fixed:"left",align:"center"}),t(l,{prop:"tf_flag",label:"真伪标志",width:"120",fixed:"left",align:"center"}),t(l,{prop:"sno",label:"冠字号码",width:"180",align:"center"}),t(l,{prop:"machine_sno",label:"机具编号",align:"center"}),t(l,{fixed:"right",prop:"image_data",label:"冠字号码图像",width:"300",align:"center"},{default:c(_=>[n("img",{src:"data:image/bmp;base64,"+_.row.image_data,alt:"冠字号码图像",style:{height:"40px"}},null,8,X)]),_:1})]),_:1},8,["data","height"])])])}}},st=V(Z,[["__scopeId","data-v-e5b7388a"]]);export{st as default};
